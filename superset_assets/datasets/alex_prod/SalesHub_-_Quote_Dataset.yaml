table_name: SalesHub - Quote Dataset
main_dttm_col: created_at
description: null
default_endpoint: null
offset: 0
cache_timeout: null
schema: public
sql: "select\n    quote.quotation_number as quotation_number,\n    quote.inquiry_id\
  \ as associated_inquiry,\n    quote.created_at as created_at,\n    carriers.name\
  \ as carrier_name,\n    carriers.carrier_type as carrier_Type,\n    quote.valid_to\
  \ as validity,\n        ig.service_type,\n    ig.movement_mode,\n    pol.name as\
  \ pol,\n    pod.name as pod,\n    pcr.name as pcr,\n    pcd.name as pcd,\n    --\
  \ origin.name as PoL,\n    -- destination.name as PoD,\n    ig.inquiry_number as\
  \ inq_seq,\n    ig.load_type,\n    inquiry.inquiry_global_id as inquiry_global,\n\
  \    -- pcr.name as PCR,\n    -- pcd.name as PCD,\n    quote.status as quote_status,\n\
  \    quote.quote_currency,\n\t  quote.exchange_rate,\n    quote.freight_buy_unit_rate,\n\
  \    quote.freight_sell_unit_rate,\n    quote.freight_sell_unit_cur,\n    quote.freight_buy_unit_cur,\n\
  \    quote.total_buy as total_buy,\n    quote.total_sell as total_sell,\n    CASE\
  \ WHEN quote.total_sell > 0 THEN (quote.total_sell - quote.total_buy) ELSE 0 END\
  \ as total_margin,\n    CASE WHEN quote.freight_buy_unit_cur=quote.freight_sell_unit_cur\
  \ THEN  quote.freight_sell_unit_rate - quote.freight_buy_unit_rate ELSE 0 END AS\
  \ freight_margin_unit_rate,\n    -- Lakhs\n    -- quote.total_buy/100000 as total_buy_lakhs,\n\
  \    -- quote.total_sell/100000 as total_sell_lakhs,\n    -- CASE WHEN quote.total_sell\
  \ > 0 THEN (quote.total_sell - quote.total_buy)/100000 ELSE 0 END as total_margin_lakhs,\n\
  \    quote.chargeable_weight as ch_weight,\n    supplier.registered_name as supplier,\n\
  \    supplier.id,\n    air.loss_reason,\n    inquiry.created_at as inquiry_created_at,\n\
  \    quote.tenant_id as tenant_id,\n    tenant.default_currency,\n    inquiry.involved_branch_id,\n\
  \    inquiry.collaborator_ids,\n    CONCAT('<a href=\"https://booking.shipmnts.com/view/rfq/',\
  \ ig.id, '\" target=\"_blank\">', ig.inquiry_number, '</a>') AS inquiry_hyperlink,\n\
  \    CONCAT('<a href=\"https://booking.shipmnts.com/view/rfq-option/', quote.id,\
  \ '\" target=\"_blank\">',quote.quotation_number,'</a>') AS quote_hyperlink,\n \
  \   ig.freight_type as freight_type,\n    inquiry.trade_type as trade_type,\n  \
  \  ig.last_action_status as inquiry_status,\n    bv.name as business_vertical,\n\
  \    sales.name as sales,\n    sales.id as sales_id,\n    pricing.first_name as\
  \ pricing_person,\n    tenant.registered_name as tenant,\n    air.teu_count as teus,\n\
  \    air.total_gross_weight,\n    air.cargo_gross_volume,\n    air.container_count\
  \ as containers,\n    customer.registered_name as customer,\n    (branch.city::json)\
  \ ->> 'name' as branch_name\n    from sales_hub_inquiry_options as quote\n    left\
  \ outer join sales_hub_inquiries as inquiry on quote.inquiry_id=inquiry.id\n   \
  \ left outer join sales_hub_inquiry_globals as ig ON inquiry.inquiry_global_id=ig.id\n\
  \    left outer join analytics_inquiry_reports as air on inquiry.id = air.id\n \
  \   left outer join companies as supplier on supplier.id = quote.booking_vendor_id\n\
  \    left outer join carriers as carriers ON quote.carrier_id=carriers.id\n    left\
  \ outer join sales_people as sales on inquiry.sales_person_id = sales.id\n    left\
  \ outer join user_contacts as pricing on inquiry.pricing_person_id = pricing.id\n\
  \    left outer join company_accounts as tenant ON tenant.id=quote.tenant_id\n \
  \   left outer join companies as customer ON customer.id=inquiry.customer_company_id\n\
  \    LEFT OUTER JOIN locations AS pol ON ig.port_of_loading_id = pol.id\n  LEFT\
  \ OUTER JOIN locations AS pod ON ig.port_of_discharge_id = pod.id\nLEFT OUTER JOIN\
  \ locations AS pcr on ig.place_of_carrier_receipt_id = pcr.id\nLEFT OUTER JOIN locations\
  \ as pcd on ig.place_of_carrier_delivery_id = pcd.id\n    -- left outer join locations\
  \ as pcr ON pcr.id = quote.place_of_carrier_receipt_id\n    -- left outer join locations\
  \ as pcd ON pcd.id = quote.place_of_carrier_delivery_id\n    left outer join business_verticals\
  \ as bv on bv.id=inquiry.business_vertical_id\n    left outer join branch_accounts\
  \ as branch on inquiry.involved_branch_id=branch.id\nwhere inquiry.tenant_id = {{url_param('tenant_id')\
  \ or 43}}\nand 'SalesHub::Inquiry' in {% if url_param('allowed_doctypes') %}\n{{\
  \ parse_url_param(url_param('allowed_doctypes')) }}\n{% else %} ('SalesHub::Inquiry')\
  \ {% endif %}\nand\n(case when {{url_param('is_collaborator') or false}} then {{url_param('user_contact_id')\
  \ or 1}}  = any(inquiry.collaborator_ids) else 1=1 end)\nand\nbranch.erp_cost_center_id\
  \ in{% if url_param('allowed_cost_centers') %} \n{{ parse_url_param(url_param('allowed_cost_centers'))\
  \ }}\n{% else %}\n(branch.erp_cost_center_id)\n{% endif %}    \nand\ncustomer.id\
  \ = {%if url_param('company') %}\n{{ url_param('company') }}\n{% else %}\ncustomer.id\n\
  {% endif %}\nand inquiry.business_vertical_id in \n{% if url_param('business_verticals')\
  \ %} \n{{ parse_url_param(url_param('business_verticals')) }}\n{% else %}\n(inquiry.business_vertical_id)\n\
  {% endif %}\n    "
params: null
template_params: null
filter_select_enabled: true
fetch_values_predicate: null
extra: null
normalize_columns: false
always_filter_main_dttm: false
uuid: 3f348298-40e0-4d14-99b3-efe47f94b006
metrics:
- metric_name: Won GP %
  verbose_name: ''
  metric_type: null
  expression: "CASE \n    WHEN SUM(CASE WHEN quote_status = 'won' THEN total_sell\
    \ ELSE 0 END) = 0 THEN 0\n    ELSE (SUM(CASE WHEN quote_status = 'won' THEN total_sell\
    \ - total_buy ELSE 0 END) * 100.0 \n    / SUM(CASE WHEN quote_status = 'won' THEN\
    \ total_sell ELSE 0 END))\n    END"
  description: null
  d3format: null
  currency: null
  extra:
    warning_markdown: ''
  warning_text: null
- metric_name: Average Margin / Sales
  verbose_name: ''
  metric_type: null
  expression: "SUM(CASE \n        WHEN quote_status = 'won' \n        THEN total_sell\
    \ - total_buy \n        ELSE 0 \n    END) / COUNT(DISTINCT sales_id)"
  description: null
  d3format: null
  currency: null
  extra:
    warning_markdown: ''
  warning_text: null
- metric_name: Lost %
  verbose_name: ''
  metric_type: null
  expression: 'SUM(

    CASE WHEN quote_status=''lost'' THEN 1 ELSE 0 END

    ) * 100 / SUM(CASE WHEN quote_status=''lost'' THEN 1 ELSE 1 END) '
  description: null
  d3format: null
  currency: null
  extra:
    warning_markdown: ''
  warning_text: null
- metric_name: Win %
  verbose_name: ''
  metric_type: null
  expression: 'SUM(

    CASE WHEN quote_status=''won'' THEN 1 ELSE 0 END

    ) * 100 / SUM(CASE WHEN quote_status=''won'' THEN 1 ELSE 1 END) '
  description: null
  d3format: null
  currency: null
  extra:
    warning_markdown: ''
  warning_text: null
- metric_name: count
  verbose_name: Quotes
  metric_type: count
  expression: COUNT(*)
  description: null
  d3format: null
  currency: null
  extra:
    warning_markdown: ''
  warning_text: null
columns:
- column_name: Quote Margin (Cur)
  verbose_name: null
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: "CASE\n  WHEN default_currency = 'INR' THEN U&'\\20B9'  -- \u20B9\n\
    \  WHEN default_currency = 'USD' THEN U&'\\0024'  -- $\n  ELSE default_currency\n\
    END || ' ' || TO_CHAR(total_margin, '99,99,99,999')\n"
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Gross Margin %
  verbose_name: null
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: "case \n\twhen total_sell > 0 then ((total_sell-total_buy) / total_sell)*100\n\
    \    else 0\nend"
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Gross Margin Won %
  verbose_name: null
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: CASE WHEN total_sell>0 and quote_status='won' THEN ((total_sell-total_buy)
    / total_sell)*100 ELSE 0 END
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Gross Margin Won
  verbose_name: Gross Margin Won
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: CASE WHEN total_sell>0 and quote_status='won' THEN total_sell-total_buy
    ELSE 0 END
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Revenue Won
  verbose_name: Revenue Won
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: CASE WHEN total_sell>0 and quote_status='won' THEN total_sell ELSE 0
    END
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Freight Margin
  verbose_name: null
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: <enter SQL expression here>
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: Gross Margin
  verbose_name: Gross Margin
  is_dttm: false
  is_active: true
  type: null
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: total_sell-total_buy
  description: Quoted GP
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: containers
  verbose_name: '# Containers '
  is_dttm: false
  is_active: true
  type: INTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: quotation_number
  verbose_name: 'Quote #'
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: ch_weight
  verbose_name: Chargeable Weight
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: created_at
  verbose_name: Quote Date
  is_dttm: true
  is_active: true
  type: DATETIME
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: branch_name
  verbose_name: Branch Name
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: business_vertical
  verbose_name: Business Vertical
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: carrier_name
  verbose_name: Carrier Name
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_type
  verbose_name: Freight Type
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: inquiry_hyperlink
  verbose_name: Inquiry Number
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: inquiry_status
  verbose_name: Inquiry Status
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: loss_reason
  verbose_name: Loss Reason
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: load_type
  verbose_name: Load Type
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: movement_mode
  verbose_name: Movement Mode
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: quote_hyperlink
  verbose_name: Quote Number
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: customer
  verbose_name: Customer
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: teus
  verbose_name: TEUs
  is_dttm: false
  is_active: true
  type: INTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: pricing_person
  verbose_name: Pricing
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: sales
  verbose_name: Sales
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: collaborator_ids
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGERARRAY
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_margin_unit_rate
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_buy_unit_rate
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_sell_unit_rate
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: cargo_gross_volume
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: total_gross_weight
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: exchange_rate
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: total_margin
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: total_buy
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: total_sell
  verbose_name: null
  is_dttm: false
  is_active: true
  type: DECIMAL
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: inquiry_created_at
  verbose_name: null
  is_dttm: true
  is_active: true
  type: DATETIME
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: validity
  verbose_name: null
  is_dttm: true
  is_active: true
  type: DATETIME
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: involved_branch_id
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: associated_inquiry
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: inquiry_global
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: sales_id
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: tenant_id
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: id
  verbose_name: null
  is_dttm: false
  is_active: true
  type: LONGINTEGER
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_buy_unit_cur
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: freight_sell_unit_cur
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: default_currency
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: carrier_type
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: trade_type
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: quote_status
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: quote_currency
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: service_type
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: inq_seq
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: tenant
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: pcd
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: pcr
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: pod
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: supplier
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
- column_name: pol
  verbose_name: null
  is_dttm: false
  is_active: true
  type: STRING
  advanced_data_type: null
  groupby: true
  filterable: true
  expression: null
  description: null
  python_date_format: null
  extra:
    warning_markdown: null
version: 1.0.0
database_uuid: aa73c28d-a640-49b8-922c-9de0bb13f81d
